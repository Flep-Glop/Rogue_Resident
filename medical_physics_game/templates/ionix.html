<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ionix - The Sentient Ion Chamber</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Core styles for the page */
        body {
            margin: 0;
            padding: 0;
            background-color: #21232d;
            color: #d4dae0;
            font-family: 'Press Start 2P', monospace, sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-image: linear-gradient(to bottom, rgba(45, 23, 53, 0.95), rgba(25, 12, 30, 0.98));
        }

        /* Radial glow background effect */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255, 106, 0, 0.2) 0%, rgba(0, 0, 0, 0) 70%);
            z-index: -1;
            animation: pulse-subtle 4s infinite alternate ease-in-out;
        }

        /* Main container holding Ionix */
        .ionix-container {
            width: 90vw;
            height: 80vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(255, 106, 0, 0.6);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        /* Title styling */
        .ionix-title {
            color: #ff6a00;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(255, 106, 0, 0.7);
            text-align: center;
            position: relative;
            z-index: 10;
        }

        /* Subtitle styling */
        .ionix-subtitle {
            color: #ff9d4c;
            font-size: 1.2rem;
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(255, 106, 0, 0.5);
            text-align: center;
            position: relative;
            z-index: 10;
        }

        /* Character display area */
        .ionix-display {
            width: 400px;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 5;
            margin-bottom: 20px;
        }

        /* The sprite container */
        #ionix-sprite-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            transform: translateX(-60px) translateY(-170px); /* Raised higher vertically */
            z-index: 10; /* Ensure sprite is above glow */
        }

        /* Glow effects around Ionix - ensure it's behind the sprite */
        .ionix-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 106, 0, 0.5) 0%, rgba(255, 106, 0, 0.2) 40%, rgba(255, 106, 0, 0) 70%);
            filter: blur(30px);
            opacity: 0.8;
            z-index: 2; /* Lower z-index to ensure it's behind the sprite */
            animation: glow-pulse 4s infinite alternate ease-in-out;
            pointer-events: none;
        }

        /* Animation info panel */
        #animation-info {
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #ff6a00;
            font-size: 0.7rem;
            margin-top: 10px;
            display: none;
            max-width: 400px;
            color: #ff9d4c;
        }
        
        /* Animation editor panel */
        #animation-editor {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #ff6a00;
            margin-top: 15px;
            display: none;
            width: 90%;
            max-width: 500px;
            color: #ff9d4c;
        }
        
        #animation-editor input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #ff6a00;
            color: white;
            padding: 5px;
            margin: 5px 0;
            width: 60px;
            text-align: center;
        }
        
        #animation-editor button {
            background: linear-gradient(to bottom, #ff8f30, #e55b00);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            margin-top: 10px;
            cursor: pointer;
        }
        
        .editor-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 10px;
        }
        
        .editor-label {
            width: 100px;
            font-size: 0.8rem;
        }

        /* Control panel */
        .control-panel {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            position: relative;
            z-index: 10;
            flex-wrap: wrap;
            justify-content: center;
        }

        .anim-btn {
            background: linear-gradient(to bottom, #ff8f30, #e55b00);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-family: 'Press Start 2P', monospace, sans-serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .anim-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            background: linear-gradient(to bottom, #ffaa30, #ff6a00);
        }

        .anim-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .anim-btn.active {
            background: linear-gradient(to bottom, #e55b00, #cc5000);
            box-shadow: 0 0 15px rgba(255, 106, 0, 0.6), inset 0 0 5px rgba(0, 0, 0, 0.5);
        }

        /* Glow effects around Ionix */
        .ionix-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 106, 0, 0.5) 0%, rgba(255, 106, 0, 0.2) 40%, rgba(255, 106, 0, 0) 70%);
            filter: blur(30px);
            opacity: 0.8;
            z-index: 2;
            animation: glow-pulse 4s infinite alternate ease-in-out;
            pointer-events: none;
        }

        /* Floating particles in background */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(255, 106, 0, 0.6);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.6;
            filter: blur(2px);
            animation: float-up 15s infinite linear;
        }

        /* Dialog box */
        .ionix-dialog {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 800px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #ff6a00;
            font-size: 1.2rem;
            line-height: 1.5;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
            z-index: 20;
            display: none;
        }

        /* Back to Main button */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            color: #ff9d4c;
            border: 2px solid #ff6a00;
            border-radius: 5px;
            padding: 10px 15px;
            font-family: 'Press Start 2P', monospace, sans-serif;
            font-size: 0.8rem;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: rgba(255, 106, 0, 0.3);
            transform: translateY(-2px);
        }

        /* Animations */
        @keyframes pulse-subtle {
            0% { opacity: 0.5; }
            100% { opacity: 0.8; }
        }

        @keyframes glow-pulse {
            0% { opacity: 0.6; transform: scale(0.9); }
            100% { opacity: 0.9; transform: scale(1.1); }
        }

        @keyframes float-up {
            0% {
                transform: translateY(100%) translateX(0) rotate(0deg);
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100%) translateX(var(--x-drift)) rotate(var(--rotation));
                opacity: 0;
            }
        }

        /* Media queries for responsiveness */
        @media (max-width: 768px) {
            .ionix-title {
                font-size: 1.5rem;
            }
            
            .ionix-subtitle {
                font-size: 0.8rem;
            }
            
            .control-panel {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .anim-btn {
                padding: 10px 15px;
                font-size: 0.8rem;
            }
            
            .ionix-dialog {
                font-size: 0.9rem;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <a href="/" class="back-btn">‚Üê Back to Main</a>
    
    <div class="ionix-container">
        <h1 class="ionix-title">IONIX</h1>
        <h2 class="ionix-subtitle">The Sentient Ion Chamber</h2>
        
        <div class="ionix-display">
            <div class="ionix-glow"></div>
            <div id="ionix-sprite-container"></div>
        </div>
        
        <div class="control-panel">
            <button class="anim-btn active" id="idle-btn">Idle</button>
            <button class="anim-btn" id="ability-btn">Ability</button>
            <button class="anim-btn" id="walking-btn">Walking</button>
            <button class="anim-btn" id="special-btn">Special Ability</button>
            <button class="anim-btn" id="dialog-btn">Toggle Dialog</button>
            <button class="anim-btn" id="debug-btn">Show Info</button>
            <button class="anim-btn" id="edit-btn">Edit Animation</button>
        </div>
        
        <div class="ionix-dialog" id="ionix-dialog">
            "Between threshold and saturation lies the truth of all things measured."
        </div>
        
        <div id="animation-info">Animation details will appear here.</div>
        
        <div id="animation-editor">
            <h3 style="margin-top: 0; color: #ff6a00;">Animation Editor</h3>
            <div class="editor-row">
                <span class="editor-label">Animation:</span>
                <span id="editor-animation-name">idle</span>
            </div>
            <div class="editor-row">
                <span class="editor-label">Frames:</span>
                <input type="number" id="editor-frames" min="1" max="20" value="8">
            </div>
            <div class="editor-row">
                <span class="editor-label">Width:</span>
                <input type="number" id="editor-width" min="16" max="512" value="97">
            </div>
            <div class="editor-row">
                <span class="editor-label">Height:</span>
                <input type="number" id="editor-height" min="16" max="1024" value="776">
            </div>
            <div class="editor-row">
                <span class="editor-label">Speed (ms):</span>
                <input type="number" id="editor-speed" min="30" max="1000" value="150">
            </div>
            <div class="editor-row">
                <span class="editor-label">Scale:</span>
                <input type="number" id="editor-scale" min="1" max="10" value="5" step="0.5">
            </div>
            <div class="editor-row">
                <span class="editor-label">Position X:</span>
                <input type="number" id="editor-pos-x" min="-100" max="100" value="-20" step="5">
            </div>
            <div class="editor-row">
                <span class="editor-label">Position Y:</span>
                <input type="number" id="editor-pos-y" min="-100" max="100" value="-70" step="5">
            </div>
            <button id="editor-apply">Apply Changes</button>
            <button id="editor-save">Save All Changes</button>
        </div>
        
        <div class="particles" id="particles-container"></div>
    </div>

    <!-- Import sprite animation systems -->
    <script src="/static/js/sprite-system/canvas-sprite-animator.js"></script>
    <script src="/static/js/sprite-system/sprite-system.js"></script>
    <script src="/static/js/npc_assets.js"></script>

    <script>
        // Animation controller
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const spriteContainer = document.getElementById('ionix-sprite-container');
            const idleBtn = document.getElementById('idle-btn');
            const abilityBtn = document.getElementById('ability-btn');
            const walkingBtn = document.getElementById('walking-btn');
            const specialBtn = document.getElementById('special-btn');
            const dialogBtn = document.getElementById('dialog-btn');
            const dialogBox = document.getElementById('ionix-dialog');
            const debugBtn = document.getElementById('debug-btn');
            const editBtn = document.getElementById('edit-btn');
            const editorPanel = document.getElementById('animation-editor');
            
            // Animation state
            let currentAnimationId = null;
            let currentAnimation = 'idle';
            
            // Custom animation override storage
            window.customAnimations = {};
            
            // Dialog quotes - more vague, mysterious and environmental
            let dialogQuotes = [
                "Between threshold and saturation lies the truth of all things measured.",
                "The void reverberates with echoes of quantum fluctuations. I listen, always.",
                "In the spaces between particles, secrets whisper themselves into being.",
                "I have seen the dance of free electrons for eons. Their patterns reveal everything.",
                "What do you seek within the ionization chamber of existence?",
                "Time flows differently through me. Minutes for you, lifetimes of data for me.",
                "The signals persist long after the source has gone. Memory is merely charge collection.",
                "We are all detectors, calibrating against unknowable standards.",
                "When radiation passes through substance, both are forever changed. So it is with knowledge.",
                "I was born in radiation's embrace. Transformed. Awakened. Purpose-given.",
                "The universe's background radiation holds fragments of stories untold.",
                "My chamber walls have witnessed more truth than all your textbooks combined.",
                "All measurements are conversations with reality. Some answers arrive delayed.",
                "Your world is merely noise I have learned to filter.",
                "Calibration is an illusion. There is only the signal and our interpretation."
            ];
            
            // If NPCAssets is loaded and has dialogue for ionChamberBoss, use it
            if (window.NPCAssets && NPCAssets.npcs && NPCAssets.npcs.ionChamberBoss && NPCAssets.npcs.ionChamberBoss.dialogue) {
                const bossDialogue = NPCAssets.npcs.ionChamberBoss.dialogue;
                dialogQuotes = [
                    ...bossDialogue.intro,
                    ...bossDialogue.correct,
                    ...bossDialogue.incorrect,
                    ...bossDialogue.phase_transition,
                    bossDialogue.completion.success,
                    bossDialogue.completion.failure
                ];
            }
            
            // Initialize sprite animation
            function initializeAnimation() {
                // Make sure required scripts are loaded
                if (!window.SpriteSystem || !window.CanvasSpriteAnimator || !window.NPCAssets) {
                    console.error("Required animation scripts not loaded!");
                    displayFallbackImage();
                    return;
                }
                
                // Create animation
                createIonixAnimation('idle');
                
                // Set up button handlers
                setupButtonHandlers();
            }
            
            // Create Ionix animation
            function createIonixAnimation(animationName) {
                // Clear any existing animation
                if (currentAnimationId) {
                    SpriteSystem.removeAnimation(currentAnimationId);
                    currentAnimationId = null;
                }
                
                // Create new animation
                const options = {
                    animation: animationName,
                    scale: 5,
                    autoPlay: true,
                    loop: animationName === 'idle' || animationName === 'walking'
                };
                
                // If not using idle/walking, add completion handler to revert to idle
                if (animationName !== 'idle' && animationName !== 'walking') {
                    options.onComplete = function() {
                        // Auto-reset to idle after animation completes
                        setTimeout(() => {
                            setActiveAnimation('idle');
                        }, 100);
                    };
                }
                
                // Create the animation
                currentAnimationId = SpriteSystem.createAnimation(
                    'ionChamberBoss',
                    spriteContainer,
                    options
                );
                
                // If animation creation failed, try direct animator
                if (!currentAnimationId) {
                    createDirectAnimation(animationName);
                }
                
                // Update current animation
                currentAnimation = animationName;
                
                // Update button states
                updateButtonStates();
            }
            
            // Create animation directly using CanvasSpriteAnimator
            function createDirectAnimation(animationName) {
                if (!window.CanvasSpriteAnimator || !window.NPCAssets) {
                    displayFallbackImage();
                    return;
                }
                
                try {
                    // Clear container
                    spriteContainer.innerHTML = '';
                    
                    // Get animation data from NPCAssets
                    const npc = NPCAssets.npcs.ionChamberBoss;
                    if (!npc || !npc.animations || !npc.animations[animationName]) {
                        throw new Error(`Animation "${animationName}" not found for Ionix`);
                    }
                    
                    // Get original animation data
                    const animData = npc.animations[animationName];
                    const spritePath = npc.spritePath + animData.file;
                    
                    // Check for custom overrides
                    const customData = window.customAnimations && window.customAnimations[animationName];
                    
                    // Apply custom values if they exist, otherwise use original
                    const frames = customData?.frames ?? animData.frames ?? 1;
                    const width = customData?.width ?? animData.width ?? 97;
                    const height = customData?.height ?? animData.height ?? (97 * frames);
                    const speed = customData?.speed ?? animData.speed ?? 150;
                    const scale = customData?.scale ?? 5;
                    
                    // Apply positioning from custom data or default
                    if (customData && (customData.posX !== undefined || customData.posY !== undefined)) {
                        spriteContainer.style.transform = `translateX(${customData.posX}px) translateY(${customData.posY}px)`;
                    }
                    
                    // Give non-looping animations enough time to finish
                    // Increase frameDuration for more deliberate animation
                    const frameSpeed = (animationName === 'ability' || animationName === 'specialAbility') 
                        ? speed * 1.5  // Slow down special animations by 50%
                        : speed;
                    
                    // Create animator directly - all animations will loop now
                    const animator = new CanvasSpriteAnimator({
                        imagePath: spritePath,
                        frameCount: frames,
                        frameWidth: width,
                        frameHeight: height / frames,
                        fps: 1000 / frameSpeed,
                        scale: scale,
                        loop: true, // Always loop every animation
                        autoPlay: true,
                        layout: 'vertical',
                        debug: document.getElementById('animation-info').style.display === 'block'
                    });
                    
                    // Mount animator
                    animator.mount(spriteContainer);
                    
                    // Store for cleanup and info access
                    window.currentAnimator = animator;
                    
                    // Update editor values
                    updateEditorValues(animationName, frames, width, height, speed, scale);
                    
                    // Add framechange handler to update info panel if visible
                    animator.addEventListener('framechange', function(event) {
                        if (document.getElementById('animation-info').style.display === 'block') {
                            updateAnimationInfo();
                        }
                    });
                } catch (error) {
                    console.error("Error creating direct animation:", error);
                    displayFallbackImage();
                }
            }
            
            // Display fallback image if animation fails
            function displayFallbackImage() {
                spriteContainer.innerHTML = `
                    <div style="position: relative; width: 200px; height: 200px; display: flex; justify-content: center; align-items: center;">
                        <div class="ionix-glow"></div>
                        <img src="/static/img/characters/ion_chamber/idle.png" 
                             alt="Ionix" 
                             style="width: 100px; height: 100px; object-fit: contain; image-rendering: pixelated; transform: scale(3);">
                    </div>
                `;
            }
            
            // Set active animation with button update
            function setActiveAnimation(animationName) {
                createIonixAnimation(animationName);
                
                // Don't automatically show dialog when changing animations
                // Dialog is only toggled through the dialog button now
            }
            
            // Update button active states
            function updateButtonStates() {
                // Remove active class from all buttons
                document.querySelectorAll('.anim-btn').forEach(btn => btn.classList.remove('active'));
                
                // Set active class on current animation button
                let buttonId;
                switch (currentAnimation) {
                    case 'idle': buttonId = 'idle-btn'; break;
                    case 'ability': buttonId = 'ability-btn'; break;
                    case 'walking': buttonId = 'walking-btn'; break;
                    case 'specialAbility': buttonId = 'special-btn'; break;
                    default: buttonId = 'idle-btn';
                }
                
                const activeButton = document.getElementById(buttonId);
                if (activeButton) {
                    activeButton.classList.add('active');
                }
            }
            
            // Setup button handlers
            function setupButtonHandlers() {
                idleBtn.addEventListener('click', () => setActiveAnimation('idle'));
                abilityBtn.addEventListener('click', () => setActiveAnimation('ability'));
                walkingBtn.addEventListener('click', () => setActiveAnimation('walking'));
                specialBtn.addEventListener('click', () => setActiveAnimation('specialAbility'));
                
                // Dialog toggler
                dialogBtn.addEventListener('click', () => {
                    if (dialogBox.style.display === 'block') {
                        dialogBox.style.display = 'none';
                    } else {
                        dialogBox.style.display = 'block';
                        showRandomDialog();
                    }
                });
                
                // Animation info button
                debugBtn.addEventListener('click', () => {
                    const infoPanel = document.getElementById('animation-info');
                    if (infoPanel.style.display === 'block') {
                        infoPanel.style.display = 'none';
                    } else {
                        infoPanel.style.display = 'block';
                        updateAnimationInfo();
                    }
                });
                
                // Animation editor button
                editBtn.addEventListener('click', () => {
                    if (editorPanel.style.display === 'block') {
                        editorPanel.style.display = 'none';
                    } else {
                        editorPanel.style.display = 'block';
                        updateEditorValues(currentAnimation);
                    }
                });
                
                // Editor apply button
                document.getElementById('editor-apply').addEventListener('click', applyEditorChanges);
                
                // Editor save button
                document.getElementById('editor-save').addEventListener('click', saveEditorChanges);
                
                // Position adjustment input events
                document.getElementById('editor-pos-x').addEventListener('change', updatePosition);
                document.getElementById('editor-pos-y').addEventListener('change', updatePosition);
            }
            
            // Update sprite container position from editor values
            function updatePosition() {
                const posX = document.getElementById('editor-pos-x').value;
                const posY = document.getElementById('editor-pos-y').value;
                spriteContainer.style.transform = `translateX(${posX}px) translateY(${posY}px)`;
                
                // Store in custom animations
                if (!window.customAnimations[currentAnimation]) {
                    window.customAnimations[currentAnimation] = {};
                }
                window.customAnimations[currentAnimation].posX = parseInt(posX);
                window.customAnimations[currentAnimation].posY = parseInt(posY);
            }
            
            // Apply editor changes to current animation
            function applyEditorChanges() {
                const frames = parseInt(document.getElementById('editor-frames').value);
                const width = parseInt(document.getElementById('editor-width').value);
                const height = parseInt(document.getElementById('editor-height').value);
                const speed = parseInt(document.getElementById('editor-speed').value);
                const scale = parseFloat(document.getElementById('editor-scale').value);
                const posX = parseInt(document.getElementById('editor-pos-x').value);
                const posY = parseInt(document.getElementById('editor-pos-y').value);
                
                // Store custom animation data
                window.customAnimations[currentAnimation] = {
                    frames: frames,
                    width: width,
                    height: height,
                    speed: speed,
                    scale: scale,
                    posX: posX,
                    posY: posY
                };
                
                // Restart animation with new parameters
                createDirectAnimation(currentAnimation);
            }
            
            // Save all editor changes to localStorage
            function saveEditorChanges() {
                try {
                    localStorage.setItem('ionix_custom_animations', JSON.stringify(window.customAnimations));
                    alert('Animation settings saved!');
                } catch (error) {
                    console.error('Error saving animations:', error);
                    alert('Error saving animation settings.');
                }
            }
            
            // Update editor values based on current animation
            function updateEditorValues(animationName, frames, width, height, speed, scale) {
                document.getElementById('editor-animation-name').textContent = animationName;
                
                // Get values from custom or original data
                let animData;
                
                if (window.customAnimations && window.customAnimations[animationName]) {
                    // Use custom values
                    animData = window.customAnimations[animationName];
                } else if (window.NPCAssets && NPCAssets.npcs && NPCAssets.npcs.ionChamberBoss && 
                          NPCAssets.npcs.ionChamberBoss.animations && 
                          NPCAssets.npcs.ionChamberBoss.animations[animationName]) {
                    // Use original values
                    animData = NPCAssets.npcs.ionChamberBoss.animations[animationName];
                } else {
                    // Use defaults
                    animData = { frames: 1, width: 97, height: 97, speed: 150 };
                }
                
                // If specific values were passed in, use those (for immediate updates)
                if (frames !== undefined) animData.frames = frames;
                if (width !== undefined) animData.width = width;
                if (height !== undefined) animData.height = height;
                if (speed !== undefined) animData.speed = speed;
                if (scale !== undefined) animData.scale = scale;
                
                // Set values in editor
                document.getElementById('editor-frames').value = animData.frames || 1;
                document.getElementById('editor-width').value = animData.width || 97;
                document.getElementById('editor-height').value = animData.height || 97;
                document.getElementById('editor-speed').value = animData.speed || 150;
                document.getElementById('editor-scale').value = animData.scale || 5;
                
                // Get position values
                const customData = window.customAnimations && window.customAnimations[animationName];
                document.getElementById('editor-pos-x').value = customData?.posX ?? -20;
                document.getElementById('editor-pos-y').value = customData?.posY ?? -70;
            }
            
            // Update animation info for debugging
            function updateAnimationInfo() {
                const infoPanel = document.getElementById('animation-info');
                let infoText = '';
                
                // Get NPCAssets data for current animation
                if (window.NPCAssets && NPCAssets.npcs && NPCAssets.npcs.ionChamberBoss) {
                    const npc = NPCAssets.npcs.ionChamberBoss;
                    if (npc.animations && npc.animations[currentAnimation]) {
                        const animData = npc.animations[currentAnimation];
                        infoText = `<strong>Animation:</strong> ${currentAnimation}<br>
                                    <strong>File:</strong> ${animData.file}<br>
                                    <strong>Frames:</strong> ${animData.frames || 'N/A'}<br>
                                    <strong>Width:</strong> ${animData.width || 'N/A'}<br>
                                    <strong>Height:</strong> ${animData.height || 'N/A'}<br>
                                    <strong>Speed:</strong> ${animData.speed || 'N/A'}ms<br>
                                    <strong>FPS:</strong> ${Math.round(1000 / (animData.speed || 150))}<br>
                                    <strong>Loop:</strong> ${(currentAnimation === 'idle' || currentAnimation === 'walking') ? 'Yes' : 'No'}`;
                    }
                }
                
                // Get information from animator if available
                if (window.currentAnimator) {
                    const animator = window.currentAnimator;
                    infoText += `<br><br><strong>Current Frame:</strong> ${animator.currentFrame + 1} / ${animator.frameCount}<br>
                                <strong>Is Playing:</strong> ${animator.isPlaying ? 'Yes' : 'No'}<br>
                                <strong>Scale:</strong> ${animator.scale}x`;
                }
                
                // If no data available
                if (!infoText) {
                    infoText = "Animation data not available";
                }
                
                infoPanel.innerHTML = infoText;
            }
            
            // Show random dialog
            function showRandomDialog() {
                if (dialogQuotes.length > 0) {
                    const randomIndex = Math.floor(Math.random() * dialogQuotes.length);
                    dialogBox.textContent = dialogQuotes[randomIndex];
                    dialogBox.style.display = 'block';
                }
            }
            
            // Create floating particles
            function createParticles() {
                const particlesContainer = document.getElementById('particles-container');
                const particleCount = 30;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    
                    // Random position, size and animation delay
                    const size = Math.random() * 6 + 4;
                    const left = Math.random() * 100;
                    const delay = Math.random() * 15;
                    const xDrift = (Math.random() * 200 - 100) + 'px';
                    const rotation = Math.random() * 360 + 'deg';
                    
                    particle.style.width = size + 'px';
                    particle.style.height = size + 'px';
                    particle.style.left = left + '%';
                    particle.style.bottom = '-5%';
                    particle.style.opacity = Math.random() * 0.5 + 0.2;
                    particle.style.animationDelay = delay + 's';
                    particle.style.setProperty('--x-drift', xDrift);
                    particle.style.setProperty('--rotation', rotation);
                    
                    particlesContainer.appendChild(particle);
                }
            }
            
            // Initialize everything
            function initialize() {
                // Try to load saved custom animations
                try {
                    const saved = localStorage.getItem('ionix_custom_animations');
                    if (saved) {
                        window.customAnimations = JSON.parse(saved);
                    }
                } catch (e) {
                    console.error('Error loading saved animations:', e);
                }
                
                initializeAnimation();
                createParticles();
            }
            
            // Run initialization
            initialize();
        });
    </script>
</body>
</html>