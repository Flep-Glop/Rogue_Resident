{% extends "base.html" %}

{% block title %}Character Selection - Medical Physics Game{% endblock %}

{% block additional_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/character.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <h1>Select Your Character</h1>
    <div id="character-selection">
        <p>Loading characters...</p>
        <!-- Character cards will be loaded here via JavaScript -->
    </div>
    <div class="character-actions">
        <button id="select-character-btn" class="btn" disabled>Select Character</button>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script type="module">
    // Simple code to fetch and display characters
    document.addEventListener('DOMContentLoaded', async function() {
        const characterSelection = document.getElementById('character-selection');
        const selectBtn = document.getElementById('select-character-btn');
        
        try {
            // Fetch characters from API
            const response = await fetch('/api/characters');
            const characters = await response.json();
            
            if (characters && characters.length > 0) {
                // Clear loading message
                characterSelection.innerHTML = '';
                
                // Create character cards
                characters.forEach(character => {
                    const card = document.createElement('div');
                    card.className = 'character-card';
                    card.innerHTML = `
                        <h3>${character.name}</h3>
                        <div class="character-stats">
                            <p>HP: ${character.max_hp}</p>
                            <p>Intellect: ${character.stats.intellect}</p>
                            <p>Precision: ${character.stats.precision}</p>
                            <p>Resilience: ${character.stats.resilience}</p>
                        </div>
                        <div class="character-abilities">
                            <h4>Abilities:</h4>
                            <ul>
                                ${character.abilities.map(ability => `<li>${ability}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                    
                    // Add click handler
                    card.addEventListener('click', function() {
                        // Remove selection from all cards
                        document.querySelectorAll('.character-card').forEach(c => 
                            c.classList.remove('selected'));
                        
                        // Add selection to this card
                        card.classList.add('selected');
                        
                        // Enable select button
                        selectBtn.disabled = false;
                    });
                    
                    characterSelection.appendChild(card);
                });
            } else {
                characterSelection.innerHTML = '<p>No characters available</p>';
            }
        } catch (error) {
            console.error('Error loading characters:', error);
            characterSelection.innerHTML = '<p>Error loading characters. Please try again.</p>';
        }
        
        // Handle character selection
        selectBtn.addEventListener('click', function() {
            const selectedCard = document.querySelector('.character-card.selected');
            if (selectedCard) {
                // In a real app, you'd save the selection and redirect
                alert(`Character selected: ${selectedCard.querySelector('h3').textContent}`);
                window.location.href = '/game';
            }
        });
    });
</script>
{% endblock %}
